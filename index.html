<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glass Inside - Wine Academy</title>
    <style>
        :root {
            --bg: var(--tg-theme-bg-color, #ffffff);
            --text: var(--tg-theme-text-color, #222222);
            --sec-bg: var(--tg-theme-secondary-bg-color, #f0f0f0);
            --accent: #ffffff;
            --hint: var(--tg-theme-hint-color, #777777);
            --btn-text: var(--tg-theme-button-text-color, #ffffff);
        }
        
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; overflow-x: hidden; }
        
        .screen { display: none; padding: 20px; animation: fadeIn 0.2s ease; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* –ü—Ä–æ—Ñ–∏–ª—å */
        .profile-card { background: var(--sec-bg); border-radius: 20px; padding: 25px; text-align: center; margin-bottom: 20px; }
        .avatar { width: 80px; height: 80px; background: var(--accent); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; margin: 0 auto 15px; }
        .progress-container { background: rgba(0,0,0,0.1); height: 10px; border-radius: 5px; margin: 15px 0 5px; overflow: hidden; }
        .progress-bar { background: var(--accent); width: 15%; height: 100%; border-radius: 5px; }

        /* –®–∫–æ–ª–∞ */
        .school-menu { display: flex; flex-direction: column; gap: 12px; }
        .school-btn { 
            background: var(--sec-bg); border-radius: 15px; padding: 20px; 
            border: 1px solid rgba(0,0,0,0.05); text-align: left; cursor: pointer;
        }
        .school-btn h3 { margin: 0 0 5px 0; color: var(--accent); }
        .school-btn p { margin: 0; font-size: 14px; color: var(--hint); }

        /* –ö–∞—Ç–∞–ª–æ–≥ */
        .sticky-header { position: sticky; top: 0; background: var(--bg); padding-bottom: 10px; z-index: 10; }
        select, input { 
            width: 100%; padding: 12px; margin-bottom: 8px; border-radius: 12px; 
            border: 1px solid rgba(0,0,0,0.1); background: var(--sec-bg); color: var(--text); 
            box-sizing: border-box; font-size: 16px; appearance: none; -webkit-appearance: none;
        }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { background: var(--sec-bg); border-radius: 15px; padding: 12px; text-align: center; }
        .card img { width: 100%; height: 140px; object-fit: contain; background: white; border-radius: 10px; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav { position: fixed; bottom: 0; width: 100%; background: var(--sec-bg); display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid rgba(0,0,0,0.1); }
        .nav-item { font-size: 11px; opacity: 0.4; cursor: pointer; text-align: center; flex: 1; }
        .nav-item.active { opacity: 1; color: var(--accent); font-weight: bold; }

        /* –ú–æ–¥–∞–ª–∫–∞ */
        #details { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); display: none; z-index: 100; padding: 20px; box-sizing: border-box; overflow-y: auto; }
    </style>
</head>
<body>

    <div id="screen-profile" class="screen">
        <div class="profile-card">
            <div class="avatar" id="user-avatar">?</div>
            <h2 id="user-full-name" style="margin: 0;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h2>
            <div id="user-username" style="color: var(--hint); margin-bottom: 15px;">@username</div>
            
            <div style="text-align: left; margin-top: 20px;">
                <span style="font-size: 14px; font-weight: bold;">üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è</span>
                <div class="progress-container">
                    <div class="progress-bar"></div>
                </div>
                <div style="font-size: 12px; color: var(--hint); display: flex; justify-content: space-between;">
                    <span>3 –∏–∑ 20 —É—Ä–æ–∫–æ–≤</span>
                    <span>15%</span>
                </div>
            </div>
        </div>
        <div style="background: var(--sec-bg); padding: 15px; border-radius: 15px; font-size: 14px;">
            <b>–í–∞—à —Å—Ç–∞—Ç—É—Å:</b> –¶–µ–Ω–∏—Ç–µ–ª—å-–Ω–æ–≤–∏—á–æ–∫ üç∑
        </div>
    </div>

    <div id="screen-school" class="screen">
        <h2 style="margin-top: 0;">üéì –í–∏–Ω–Ω–∞—è —à–∫–æ–ª–∞</h2>
        <div class="school-menu">
            <div class="school-btn" onclick="alertMsg('–ë–∞–∑–æ–≤—ã–π –∫—É—Ä—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω!')">
                <h3>üéì –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å</h3>
                <p>–ò—Å—Ç–æ—Ä–∏—è, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–¥–∞—á–∏ –≤–∏–Ω–∞.</p>
            </div>
            <div class="school-btn" onclick="alertMsg('–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∫—É—Ä—Å —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –±–∞–∑–æ–≤–æ–≥–æ!')">
                <h3>üöÄ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å</h3>
                <p>–°–ª–µ–ø—ã–µ –¥–µ–≥—É—Å—Ç–∞—Ü–∏–∏, —Ç–µ—Ä—Ä—É–∞—Ä—ã –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ –≤–∏–Ω–∞.</p>
            </div>
        </div>
    </div>

    <div id="screen-catalog" class="screen">
        <div class="sticky-header">
            <select id="cat-select" onchange="loadData()">
                <option value="reds">üç∑ –ö—Ä–∞—Å–Ω—ã–µ –≤–∏–Ω–∞</option>
                <option value="whites">ü•Ç –ë–µ–ª—ã–µ –≤–∏–Ω–∞</option>
                <option value="sparkling">üçæ –ò–≥—Ä–∏—Å—Ç—ã–µ –≤–∏–Ω–∞</option>
                <option value="rose">üå∏ –†–æ–∑–æ–≤—ã–µ –≤–∏–Ω–∞</option>
                <option value="dessert">üçØ –î–µ—Å–µ—Ä—Ç–Ω—ã–µ –≤–∏–Ω–∞</option>
            </select>
            <input type="text" id="search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." oninput="render()">
        </div>
        <div id="loader" style="text-align: center; display: none; padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏...</div>
        <div id="grid" class="grid"></div>
    </div>

    <div id="details">
        <div onclick="document.getElementById('details').style.display='none'" style="color: var(--accent); font-weight: bold; cursor: pointer; margin-bottom: 20px;">‚ùÆ –ù–ê–ó–ê–î</div>
        <div id="details-body"></div>
    </div>

    <div class="nav">
        <div class="nav-item" id="tab-profile" onclick="switchTab('profile')">üë§<br>–ü—Ä–æ—Ñ–∏–ª—å</div>
        <div class="nav-item" id="tab-school" onclick="switchTab('school')">üéì<br>–®–∫–æ–ª–∞</div>
        <div class="nav-item" id="tab-catalog" onclick="switchTab('catalog')">üç∑<br>–ö–∞—Ç–∞–ª–æ–≥</div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let wines = [];
        const params = new URLSearchParams(window.location.search);
        const initialTab = params.get('page') || 'profile';

        function switchTab(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(`screen-${id}`).classList.add('active');
            document.getElementById(`tab-${id}`).classList.add('active');
            if(id === 'catalog' && wines.length === 0) loadData();
        }

        // –ö–ê–¢–ê–õ–û–ì
        async function loadData() {
            const cat = document.getElementById('cat-select').value;
            const loader = document.getElementById('loader');
            loader.style.display = 'block';
            try {
                const res = await fetch(`https://api.sampleapis.com/wines/${cat}`);
                wines = await res.json();
                render();
            } catch(e) { console.error(e); }
            loader.style.display = 'none';
        }

        function render() {
            const q = document.getElementById('search').value.toLowerCase();
            const filtered = wines.filter(w => w.wine.toLowerCase().includes(q));
            document.getElementById('grid').innerHTML = filtered.map(w => `
                <div class="card" onclick="showPop(${w.id})">
                    <img src="${w.image}" onerror="this.src='https://via.placeholder.com/100?text=Wine'">
                    <h4>${w.wine}</h4>
                    <div style="color:#d4af37; font-size:12px;">‚òÖ ${w.rating.average}</div>
                </div>
            `).join('');
        }

        function showPop(id) {
            const w = wines.find(x => x.id === id);
            document.getElementById('details-body').innerHTML = `
                <div style="text-align:center; background:white; border-radius:15px; padding:10px;">
                    <img src="${w.image}" style="max-height:250px; object-fit:contain;">
                </div>
                <h2>${w.wine}</h2>
                <p><b>–í–∏–Ω–æ–¥–µ–ª—å–Ω—è:</b> ${w.winery}</p>
                <p><b>–†–µ–≥–∏–æ–Ω:</b> ${w.location}</p>
                <p><b>–†–µ–π—Ç–∏–Ω–≥:</b> ‚≠ê ${w.rating.average} (${w.rating.reviews})</p>
            `;
            document.getElementById('details').style.display = 'block';
        }

        function alertMsg(text) {
            tg.showPopup({ message: text });
        }

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
        const user = tg.initDataUnsafe.user;
        if(user) {
            document.getElementById('user-full-name').innerText = user.first_name + (user.last_name ? ' ' + user.last_name : '');
            document.getElementById('user-username').innerText = user.username ? '@' + user.username : 'ID: ' + user.id;
            document.getElementById('user-avatar').innerText = user.first_name.charAt(0);
        }

        switchTab(initialTab);
    </script>
</body>
</html>
