<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glass Inside - Wine Academy</title>
    <style>
        :root {
            --bg: var(--tg-theme-bg-color, #ffffff);
            --text: var(--tg-theme-text-color, #222222);
            --sec-bg: var(--tg-theme-secondary-bg-color, #f0f0f0);
            --accent: #ffffff;
            --hint: var(--tg-theme-hint-color, #777777);
        }
        
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; }
        .screen { display: none; padding: 20px; animation: fadeIn 0.2s ease; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* –°—Ç–∏–ª–∏ –ü—Ä–æ—Ñ–∏–ª—è –∏ –®–∫–æ–ª—ã –∫–∞–∫ –≤ –ø—Ä–æ—à–ª–æ–º –æ—Ç–≤–µ—Ç–µ */
        .profile-card { background: var(--sec-bg); border-radius: 20px; padding: 25px; text-align: center; }
        .avatar { width: 80px; height: 80px; background: var(--accent); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; margin: 0 auto 15px; }
        .school-btn { background: var(--sec-bg); border-radius: 15px; padding: 20px; margin-bottom: 12px; border: 1px solid rgba(0,0,0,0.05); }

        /* –ö–∞—Ç–∞–ª–æ–≥ */
        select, input { width: 100%; padding: 12px; margin-bottom: 8px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.1); background: var(--sec-bg); color: var(--text); box-sizing: border-box; font-size: 16px; appearance: none; -webkit-appearance: none; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { background: var(--sec-bg); border-radius: 15px; padding: 12px; text-align: center; cursor: pointer; }
        .card img { width: 100%; height: 120px; object-fit: contain; background: white; border-radius: 10px; }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (–ö–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–Ω–∞) */
        #details { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); display: none; z-index: 100; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .back-link { color: var(--accent); font-weight: bold; cursor: pointer; display: block; margin-bottom: 15px; }
        .pairing-badge { background: #fff8e1; color: #f57c00; padding: 8px 12px; border-radius: 10px; font-size: 14px; margin-top: 10px; display: inline-block; border: 1px solid #ffe082; }
        
        /* –ü–æ—Ö–æ–∂–∏–µ –≤–∏–Ω–∞ */
        .similar-title { margin-top: 25px; font-size: 16px; font-weight: bold; }
        .similar-grid { display: flex; overflow-x: auto; gap: 10px; padding: 10px 0; scrollbar-width: none; }
        .similar-grid::-webkit-scrollbar { display: none; }
        .similar-card { min-width: 120px; background: var(--sec-bg); border-radius: 12px; padding: 8px; text-align: center; font-size: 12px; }
        .similar-card img { width: 80px; height: 80px; object-fit: contain; background: white; border-radius: 8px; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav { position: fixed; bottom: 0; width: 100%; background: var(--sec-bg); display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid rgba(0,0,0,0.1); }
        .nav-item { font-size: 11px; opacity: 0.4; cursor: pointer; text-align: center; flex: 1; }
        .nav-item.active { opacity: 1; color: var(--accent); font-weight: bold; }
    </style>
</head>
<body>

    <div id="screen-profile" class="screen">
        <div class="profile-card">
            <div class="avatar" id="user-avatar">?</div>
            <h2 id="user-full-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h2>
            <p id="user-username" style="color: var(--hint)">@username</p>
        </div>
    </div>

    <div id="screen-school" class="screen">
        <h2>üéì –®–∫–æ–ª–∞</h2>
        <div class="school-btn" onclick="tg.showPopup({message:'–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'})"><h3>üéì –ë–∞–∑–æ–≤—ã–π</h3><p>–û—Å–Ω–æ–≤—ã –≤–∏–Ω–Ω–æ–π –∫—É–ª—å—Ç—É—Ä—ã</p></div>
    </div>

    <div id="screen-catalog" class="screen">
        <select id="cat-select" onchange="loadData()">
            <option value="reds">üç∑ –ö—Ä–∞—Å–Ω—ã–µ</option>
            <option value="whites">ü•Ç –ë–µ–ª—ã–µ</option>
            <option value="sparkling">üçæ –ò–≥—Ä–∏—Å—Ç—ã–µ</option>
            <option value="rose">üå∏ –†–æ–∑–æ–≤—ã–µ</option>
            <option value="dessert">üçØ –î–µ—Å–µ—Ä—Ç–Ω—ã–µ</option>
        </select>
        <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫..." oninput="render()">
        <div id="grid" class="grid"></div>
    </div>

    <div id="details">
        <span class="back-link" onclick="document.getElementById('details').style.display='none'">‚ùÆ –ù–ê–ó–ê–î</span>
        <div id="details-body"></div>
    </div>

    <div class="nav">
        <div class="nav-item active" id="tab-profile" onclick="switchTab('profile')">üë§<br>–ü—Ä–æ—Ñ–∏–ª—å</div>
        <div class="nav-item" id="tab-school" onclick="switchTab('school')">üéì<br>–®–∫–æ–ª–∞</div>
        <div class="nav-item" id="tab-catalog" onclick="switchTab('catalog')">üç∑<br>–ö–∞—Ç–∞–ª–æ–≥</div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let wines = [];
        
        const pairings = {
            reds: "üçñ –°—Ç–µ–π–∫, –≤—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–µ —Å—ã—Ä—ã, –ª–∞–∑–∞–Ω—å—è",
            whites: "üêü –ë–µ–ª–∞—è —Ä—ã–±–∞, –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã, –º—è–≥–∫–∏–µ —Å—ã—Ä—ã",
            sparkling: "üçì –ö–ª—É–±–Ω–∏–∫–∞, –ª–µ–≥–∫–∏–µ –∑–∞–∫—É—Å–∫–∏, —É—Å—Ç—Ä–∏—Ü—ã",
            rose: "ü•ó –°–∞–ª–∞—Ç—ã, —Ä–æ–ª–ª—ã, –ø—Ç–∏—Ü–∞ –Ω–∞ –≥—Ä–∏–ª–µ",
            dessert: "üç∞ –§—Ä—É–∫—Ç–æ–≤—ã–µ –ø–∏—Ä–æ–≥–∏, —à–æ–∫–æ–ª–∞–¥, –≥–æ–ª—É–±—ã–µ —Å—ã—Ä—ã"
        };

        function switchTab(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(`screen-${id}`).classList.add('active');
            document.getElementById(`tab-${id}`).classList.add('active');
            if(id === 'catalog' && wines.length === 0) loadData();
        }

        async function loadData() {
            const cat = document.getElementById('cat-select').value;
            const res = await fetch(`https://api.sampleapis.com/wines/${cat}`);
            wines = await res.json();
            render();
        }

        function render() {
            const q = document.getElementById('search').value.toLowerCase();
            const filtered = wines.filter(w => w.wine.toLowerCase().includes(q));
            document.getElementById('grid').innerHTML = filtered.map(w => `
                <div class="card" onclick="showPop(${w.id})">
                    <img src="${w.image}" onerror="this.src='https://via.placeholder.com/100?text=Wine'">
                    <h4>${w.wine}</h4>
                    <div style="color:#d4af37; font-size:12px;">‚òÖ ${w.rating.average}</div>
                </div>
            `).join('');
        }

        function showPop(id) {
            const w = wines.find(x => x.id === id);
            const cat = document.getElementById('cat-select').value;
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è
            const description = `–≠—Ç–æ –≤–µ–ª–∏–∫–æ–ª–µ–ø–Ω–æ–µ –≤–∏–Ω–æ –æ—Ç –≤–∏–Ω–æ–¥–µ–ª—å–Ω–∏ <b>${w.winery}</b>, —Å–æ–∑–¥–∞–Ω–Ω–æ–µ –≤ —Ä–µ–≥–∏–æ–Ω–µ <b>${w.location}</b>. –û–Ω–æ –æ–±–ª–∞–¥–∞–µ—Ç —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤–∫—É—Å–æ–º –∏ –ø–æ–ª—É—á–∏–ª–æ –≤—ã—Å–æ–∫—É—é –æ—Ü–µ–Ω–∫—É ${w.rating.average}/5 –æ—Ç —ç–∫—Å–ø–µ—Ä—Ç–æ–≤.`;
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Ö–æ–∂–∏—Ö (3-4 —à—Ç—É–∫–∏ —Ç–æ–≥–æ –∂–µ —Ç–∏–ø–∞)
            const similar = wines.filter(x => x.id !== id).slice(0, 4);

            document.getElementById('details-body').innerHTML = `
                <div style="text-align:center"><img src="${w.image}" style="max-height:220px; background:white; border-radius:15px; padding:10px;"></div>
                <h2>${w.wine}</h2>
                <div class="pairing-badge">üçΩ ${pairings[cat]}</div>
                <p style="margin-top:20px; line-height:1.5;">${description}</p>
                <p><b>–†–µ–≥–∏–æ–Ω:</b> ${w.location}</p>
                
                <div class="similar-title">–ü–æ—Ö–æ–∂–∏–µ –≤–∏–Ω–∞</div>
                <div class="similar-grid">
                    ${similar.map(s => `
                        <div class="similar-card" onclick="showPop(${s.id})">
                            <img src="${s.image}" onerror="this.src='https://via.placeholder.com/80?text=Wine'">
                            <div style="margin-top:5px; height:24px; overflow:hidden;">${s.wine}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('details').style.display = 'block';
            document.getElementById('details').scrollTo(0, 0);
        }

        const user = tg.initDataUnsafe.user;
        if(user) {
            document.getElementById('user-full-name').innerText = user.first_name + (user.last_name ? ' ' + user.last_name : '');
            document.getElementById('user-username').innerText = user.username ? '@' + user.username : 'ID: ' + user.id;
            document.getElementById('user-avatar').innerText = user.first_name.charAt(0);
        }

        switchTab('profile');
    </script>
</body>
</html>
